@model Booking
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Booking - Nishikigoi Ordering Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f9f9f9;
            line-height: 1.6;
            padding-top: 3rem;
            transition: background-color 0.3s ease;
        }

        .form-order-container {
            max-width: 75%;
            margin: 3rem auto;
            padding: 3.5rem 3rem;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

            .form-order-container:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            }

        .form-section h3 {
            background-color: linear-gradient(45deg, #FFBB00, #FF8800);
            color: #333;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.6rem;
        }

        .form-floating-label {
            position: relative;
            margin-bottom: 1.5rem;
        }

            .form-floating-label input,
            .form-floating-label select,
            .form-floating-label textarea {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                border-radius: 10px;
                border: 1px solid #ddd;
                transition: border-color 0.3s ease, box-shadow 0.3s ease;
                outline: none;
                background-color: transparent;
                appearance: none;
                margin-bottom: 2rem;
            }

            .form-floating-label label {
                position: absolute;
                top: 1rem;
                left: 1rem;
                background-color: white;
                padding: 0 0.5rem;
                font-size: 1rem;
                color: #999;
                transition: all 0.3s ease;
                pointer-events: none;
            }

            .form-floating-label input:focus,
            .form-floating-label select:focus,
            .form-floating-label textarea:focus {
                border-color: #5BB2F1;
                box-shadow: 0 0 10px rgba(91, 178, 241, 0.2);
            }

                .form-floating-label input:not(:placeholder-shown) + label,
                .form-floating-label input:focus + label,
                .form-floating-label select:focus + label,
                .form-floating-label select:not(:placeholder-shown) + label,
                .form-floating-label textarea:not(:placeholder-shown) + label,
                .form-floating-label textarea:focus + label {
                    top: -10px;
                    font-size: 0.85rem;
                    color: #5BB2F1;
                }

        .progress-bar-container {
            margin: 1.5rem 0;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar-fill {
            background: #5BB2F1;
            width: 0;
            height: 100%;
            transition: width 0.4s ease;
        }

        .error-message {
            font-size: 0.9rem;
            color: #FF6666;
            display: block;
            position: relative;
            margin-top: -10px;
            z-index: 100;
            background-color: #fff;
            padding: 2px 5px;
            border: 1px solid #FF6666;
            border-radius: 5px;
            white-space: nowrap;
        }

        .btn-submit {
            background: linear-gradient(45deg, #5BB2F1, #4A9ED4);
            color: #fff;
            font-weight: bold;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 30px;
            transition: background 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-size: 1.2rem;
        }

            .btn-submit:hover {
                background: linear-gradient(45deg, #4A9ED4, #3989BF);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            }

            .btn-submit:focus {
                outline: none;
                box-shadow: 0 0 10px rgba(91, 178, 241, 0.5);
            }
    </style>
</head>
<body>
    <div class="container form-order-container">
        <h2 class="text-center mb-4">Form Order - Nishikigoi Ordering Service</h2>
        <div class="progress-bar-container">
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBar"></div>
            </div>
        </div>
        <form asp-controller="Booking" asp-action="Create" method="post" id="orderForm">
            <div class="form-section">
                <h3>General Information</h3>
                <div class="row">
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="Fullname" class="form-control" placeholder=" " id="Fullname" />
                        <label asp-for="Fullname">Full Name</label>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="Phone" class="form-control" placeholder=" " id="Phone" />
                        <label asp-for="Phone">Phone Number</label>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="Email" class="form-control" placeholder=" " id="Email" />
                        <label asp-for="Email">Email</label>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <select asp-for="Gender" class="form-select" id="Gender">
                            <option value="" disabled selected>Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                        <label asp-for="Gender">Gender</label>
                    </div>
                </div>
            </div>

            <!-- Trip Design Information Section -->
            <div class="form-section">
                <h3>Trip Design Information</h3>
                <div class="row">
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="Favoritefarm" class="form-control" placeholder=" " id="Favoritefarm" />
                        <label asp-for="Favoritefarm">The farm you want to come</label>
                        <span asp-validation-for="Favoritefarm" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="FavoriteKoi" class="form-control" placeholder=" " id="FavoriteKoi" />
                        <label asp-for="FavoriteKoi">Koi breed you want to buy</label>
                        <span asp-validation-for="FavoriteKoi" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="StartDate" type="date" class="form-control" placeholder=" " id="StartDate" />
                        <label asp-for="StartDate">Start date</label>
                        <span asp-validation-for="StartDate" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="EndDate" type="date" class="form-control" placeholder=" " id="EndDate" />
                        <label asp-for="EndDate">End date</label>
                        <span asp-validation-for="EndDate" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="EstimatedCost" type="number" class="form-control" placeholder=" " id="EstimatedCost" />
                        <label asp-for="EstimatedCost">Estimated cost</label>
                        <span asp-validation-for="EstimatedCost" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 form-floating-label">
                        <input asp-for="HotelAccommodation" class="form-control" placeholder=" " id="HotelAccommodation" />
                        <label asp-for="HotelAccommodation">Hotel accommodation</label>
                        <span asp-validation-for="HotelAccommodation" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <!-- Additional Information Section -->
            <div class="form-section">
                <h3>Additional Information</h3>
                <div class="form-floating-label">
                    <textarea asp-for="Note" class="form-control" rows="4" placeholder=" " id="Note"></textarea>
                    <label asp-for="Note">Additional Information</label>
                    <span asp-validation-for="Note" class="text-danger"></span>
                </div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-submit">Send Request</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>
  <script>
 document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('orderForm');
    const progressBar = document.getElementById('progressBar');
    const formElements = form.querySelectorAll('input, select, textarea'); // Tất cả các trường nhập liệu
    const requiredFields = ['Fullname', 'Phone', 'Email', 'FavoriteKoi', 'StartDate', 'EndDate']; // Các trường bắt buộc
    
    // Lấy ngày hiện tại (today) và đặt giờ về 0 để chỉ lấy phần ngày
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Đặt giờ về 0 để so sánh chính xác theo ngày

    // Tính ngày sau 3 ngày kể từ hôm nay
    const minStartDate = new Date();
    minStartDate.setDate(today.getDate() + 3); // Ngày bắt đầu phải sau 3 ngày kể từ hôm nay
    minStartDate.setHours(0, 0, 0, 0); // Đảm bảo chỉ lấy phần ngày

    // Bắt sự kiện nhập hoặc thay đổi cho tất cả các trường để cập nhật thanh tiến trình
    formElements.forEach(function(element) {
        element.addEventListener('input', function() {
            // Kiểm tra định dạng chỉ khi người dùng đang nhập vào
            if (element.value.trim() !== "" && requiredFields.includes(element.id)) {
                validateField(element); // Chỉ validate nếu trường không trống
            }
            updateProgress(); // Cập nhật thanh tiến trình
        });
    });

    // Attach event listener to the form's submit event
    form.addEventListener('submit', function (e) {
        let valid = true;

        // Validate các trường bắt buộc khi submit (chỉ hiển thị lỗi khi bấm submit)
        requiredFields.forEach(function(fieldId) {
            const field = document.getElementById(fieldId);
            if (field.value.trim() === "") {
                showError(field, `${field.labels[0].innerText} is required.`);
                valid = false;
            } else {
                hideError(field); // Remove error if the field is filled
            }
        });

        // Nếu form không hợp lệ, ngăn việc submit
        if (!valid) {
            e.preventDefault(); // Ngăn chặn form nếu không hợp lệ
        }
    });

    // Validate từng trường cho định dạng
    function validateField(field) {
        const fieldId = field.id;
        switch (fieldId) {
            case 'Phone':
                return validatePhone();
            case 'Email':
                return validateEmail();
            case 'StartDate':
                return validateStartDate();
            case 'EndDate':
                return validateEndDate();
            default:
                // Không kiểm tra các trường khác ngay lập tức
                return true;
        }
    }

    // Validate Phone Number
    function validatePhone() {
        const phone = document.getElementById('Phone');
        const phonePattern = /^\d{10,11}$/;
        if (!phonePattern.test(phone.value)) {
            showError(phone, 'Please enter a valid phone number (10-11 digits).');
            return false;
        } else {
            hideError(phone);
            return true;
        }
    }

    // Validate Email
    function validateEmail() {
        const email = document.getElementById('Email');
        const emailPattern = /^[a-zA-Z0-9._-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        if (!emailPattern.test(email.value)) {
            showError(email, 'Please enter a valid email address.');
            return false;
        } else {
            hideError(email);
            return true;
        }
    }

    // Validate Start Date (phải sau 3 ngày kể từ hôm nay)
    function validateStartDate() {
        const startDate = document.getElementById('StartDate');
        if (new Date(startDate.value) <= minStartDate) {
            showError(startDate, `Start date must be at least 3 days after today (${formatDate(minStartDate)}).`);
            return false;
        } else {
            hideError(startDate);
            return true;
        }
    }

    // Validate End Date (phải sau Start Date, cách Start Date ít nhất 2 ngày, và trong vòng 14 ngày)
    function validateEndDate() {
        const startDate = document.getElementById('StartDate');
        const endDate = document.getElementById('EndDate');
        
        if (new Date(endDate.value) <= new Date(startDate.value)) {
            showError(endDate, 'End date must be after the start date.');
            return false;
        }

        const start = new Date(startDate.value);
        const end = new Date(endDate.value);
        const timeDiff = end - start;
        const daysDiff = timeDiff / (1000 * 3600 * 24);

        if (daysDiff < 2) {
            showError(endDate, 'The trip must be at least 2 days long.');
            return false;
        } else if (daysDiff > 14) {
            showError(endDate, 'The trip duration must be within 14 days.');
            return false;
        } else {
            hideError(endDate);
            return true;
        }
    }

    // Show error message
    function showError(field, message) {
        let errorElement = field.parentNode.querySelector('.error-message');
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.classList.add('error-message');
            field.parentNode.appendChild(errorElement);
        }
        errorElement.innerText = message;
        field.classList.add('is-invalid');
    }

    // Hide error message
    function hideError(field) {
        let errorElement = field.parentNode.querySelector('.error-message');
        if (errorElement) {
            errorElement.remove();
        }
        field.classList.remove('is-invalid');
    }

    // Progress bar update logic
    function updateProgress() {
        let validElements = 0;

        formElements.forEach(function (element) {
            if (element.value.trim() !== "" && (element.classList.contains('is-valid') || !element.classList.contains('is-invalid'))) {  // Only count if the field is valid or not showing an error
                validElements++;
            }
        });

        // Cập nhật thanh tiến trình
        const progressPercentage = (validElements / formElements.length) * 100;
        progressBar.style.width = progressPercentage + '%';
    }

    // Format date as yyyy-mm-dd
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0'); // Tháng 1-12
        const day = String(date.getDate()).padStart(2, '0'); // Ngày 01-31
        return `${year}-${month}-${day}`;
    }
});

</script>


</body>
</html>