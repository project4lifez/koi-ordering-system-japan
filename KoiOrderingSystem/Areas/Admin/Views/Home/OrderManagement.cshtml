@model IEnumerable<KoiOrderingSystem.Models.Booking>

@{
    ViewData["Title"] = "Order Management";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    var roleId = Context.Session.GetInt32("RoleId"); // Lấy RoleId từ Session

}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Table Adjustments */
        .table td, .table th {
            vertical-align: middle;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .table td, .table th {
            text-align: center;
        }

        /* Modal Form Styling */
        .modal-content {
            padding: 20px;
            border-radius: 8px;
        }

        .modal-header h5 {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Action Buttons */
        .action-btn {
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
        }

            .action-btn:hover {
                background-color: #f0f0f0;
            }

        /* Tooltip */
        [data-bs-toggle="tooltip"] {
            cursor: pointer;
        }

        /* Improve table hover */
        .table-hover tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Custom styles for different statuses */
        .badge-pending {
            background-color: #808080; /* Gray for Pending */
        }

        .badge-cancel {
            background-color: #dc3545; /* Red for Cancel */
        }

        .badge-confirm {
            background-color: #28a745; /* Green for Confirm */
        }

        .badge-other {
            background-color: #ffc107; /* Yellow for other statuses */
        }

        /* Center buttons in modal footer */
        .modal-footer {
            justify-content: center;
        }
    </style>
</head>

<body>
    <main class="container-fluid px-4">
        <h1 class="mt-4">Order Management</h1>

        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>BookingID</th>
                        <th>Booking Date</th>
                        <th>Customer</th>
                        <th>Trip Name</th>
                        <th>Price</th>
                        @if (roleId == 2 || roleId == 3)
                        {
                            <!-- Only add these headers for roleId 2 and 3 -->
                            <th>Status</th>
                            <th>Booking Form</th>
                        }
                        @if (roleId >= 2 && roleId <= 5)
                        {
                            <th>Edit</th> <!-- Edit column for all roles -->
                            @if (roleId == 2 || roleId == 3)
                            {
                                <th>Detail</th> <!-- Detail column only for role 2 and 3 -->
                            }
                        }
                    </tr>
                </thead>

                @if (Model != null && Model.Any())
                {
                    <tbody>
                        @foreach (var booking in Model)
                        {
                            <tr>
                                <td>@booking.BookingId</td>
                                <td>@booking.BookingId</td>
                                <td>@booking.BookingDate</td>
                                <td class="text-success">@booking.Fullname</td>
                                <td>Null</td>
                                <td>@booking.QuotedAmount</td>

                                @if (roleId == 2 || roleId == 3)
                                {
                                    <!-- Only render these columns for roleId 2 and 3 -->
                                    <td>
                                        @* Conditional logic for status badge color *@
                                        @{
                                            string statusClass = booking.Status.ToLower() switch
                                            {
                                                "pending" => "badge-pending",
                                                "cancel" => "badge-cancel",
                                                "confirm" => "badge-confirm",
                                                _ => "badge-other"
                                            };
                                        }
                                        <span class="badge @statusClass">@booking.Status</span>
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" class="btn btn-primary btn-sm"
                                           onclick="openFormModal('@booking.Fullname', '@booking.Phone', '@booking.Email',
                                                         '@booking.Gender', '@booking.Favoritefarm',
                                                         '@booking.StartDate', '@booking.EndDate',
                                                         '@booking.EstimatedCost', '@booking.HotelAccommodation',
                                                         '@booking.Note')">View Form</a>
                                    </td>
                                }

                                <!-- Edit logic for all roles (2, 3, 4, 5) -->
                                <td>
                                    @if (roleId == 2)
                                        @if (roleId == 2)
                                        {
                                            <a href="@Url.Action("Manager", "Admin", new { id = booking.BookingId })" class="btn btn-warning btn-sm">Edit</a>
                                        }
                                    @if (roleId == 3)
                                    {
                                        <a href="@Url.Action("Sale", "Admin", new { id = booking.BookingId })" class="btn btn-warning btn-sm">Edit</a>
                                    }
                                    @if (roleId == 4)
                                    {
                                        <a href="@Url.Action("Consulting", "Admin", new { id = booking.BookingId })" class="btn btn-warning btn-sm">Edit</a>
                                    }
                                    @if (roleId == 5)
                                    {
                                        <a href="/Admin/Delivering/Delivering?id=@booking.BookingId" class="btn btn-warning btn-sm">Edit</a>
                                    }


                                </td>

                                @if (roleId == 2 || roleId == 3)
                                {
                                    <!-- Detail logic for only roles 2 and 3 -->
                                    <td>
                                        <a href="/Admin/Sale/Quote?bookingId=@booking.BookingId" class="btn btn-info btn-sm">Detail</a>
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                }
                else
                {
                    <p>No bookings available.</p>
                }
            </table>
        </div>



        <!-- Modal for Form -->
        <div class="modal fade" id="formModal" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="formModalLabel">Customer Booking </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formFullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="formFullName" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formPhone" class="form-label">Phone</label>
                                    <input type="text" class="form-control" id="formPhone" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formEmail" class="form-label">Email</label>
                                    <input type="text" class="form-control" id="formEmail" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formGender" class="form-label">Gender</label>
                                    <input type="text" class="form-control" id="formGender" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formFarm" class="form-label">The farm which want to come</label>
                                    <input type="text" class="form-control" id="formFarm" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formStartDate" class="form-label">Estimated departure date</label>
                                    <input type="text" class="form-control" id="formStartDate" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formEndDate" class="form-label">Return date</label>
                                    <input type="text" class="form-control" id="formEndDate" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formCost" class="form-label">Estimated cost</label>
                                    <input type="text" class="form-control" id="formCost" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="formHotel" class="form-label">Hotel accommodation</label>
                                    <input type="text" class="form-control" id="formHotel" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="formNote" class="form-label">Additional Information</label>
                            <textarea id="formNote" class="form-control" rows="4" readonly></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="printForm()">Print Form</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function openFormModal(fullName, phone, email, gender, farm, startDate, endDate, cost, hotel, note) {
            document.getElementById('formFullName').value = fullName || 'N/A';
            document.getElementById('formPhone').value = phone || 'N/A';
                    document.getElementById('formEmail').value = email || 'N/A';
            document.getElementById('formGender').value = gender || 'N/A';
            document.getElementById('formFarm').value = farm || 'N/A';
            document.getElementById('formStartDate').value = startDate || 'N/A';
                document.getElementById('formEndDate').value = endDate || 'N/A';
                    document.getElementById('formCost').value = cost || 'N/A';
                    document.getElementById('formHotel').value = hotel || 'N/A';
                    document.getElementById('formNote').value = note || 'N/A';

                    const formModal = new bootstrap.Modal(document.getElementById('formModal'));
                    formModal.show();
                }

                function printForm() {
                    const printContent = document.getElementById('formModal').innerHTML;
                    const win = window.open('', '', 'width=800,height=600');
                    win.document.write(printContent);
                    win.document.close();
                    win.print();
                    win.close();
                }

                // Initialize Bootstrap tooltips
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl)
                })
    </script>

    <!-- Bootstrap JS for modal and tooltip functionality -->
</body>
